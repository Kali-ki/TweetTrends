<html>
<head>
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TweetTrends</title>
    <script type="text/javascript" src="/eel.js"></script>
    <style>
        body {
            background: rgb(136, 210, 222);
            color: white;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        img {
            height: 100px;
        }
        #keywordslist{
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 2em;
        }
        .image-selector {
            display: none;
        }
        .vignette {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>

<body>
    <h1>Trends timeline</h1>
    <select name="periods" id="periods">
        <!--datestopropose-->
      </select>
      <input type="checkbox" id="crop-check" checked>
      <label>Supprimer arri√®re-plan</label>
      <div id="keywordslist">

      </div>
    <script type="text/javascript">
        document.getElementById('periods').addEventListener('change',(evt)=>{
            changePeriodJs(evt.target.value)
        })
        
        eel.expose(changePeriodJs);
        function changePeriodJs(periodid){
            eel.loadPeriodPy(periodid)
        }
        
        eel.expose(loadPeriodJs);
        function loadPeriodJs(keywords) {
            let el = document.getElementById('keywordslist');
            el.innerHTML = '';
            el.hidden=true;
            for(let keyword of keywords){
                let id = keyword.split(" ").join("-");
                const vignette = document.createElement('div');
                vignette.className='vignette';
                vignette.innerHTML='<div class="illustration"> <label for="file-upload-'+id+'"><img src="images/emptyimage.svg"></label> <input class="image-selector"  id="file-upload-'+id+'"  type="file" accept="image/png, image/jpeg" onchange=" changeImageFromInputEvent(event)"> </div><div class="description">'+keyword+'</div>';
                vignette.innerHTML+='</div>';
                el.appendChild(vignette);
            }
            eel.illustratePeriodPy(keywords);
            el.hidden=false;
        }
        
        eel.expose(illustratePeriodJs);
        function illustratePeriodJs(periodinfos){
            for(let keywordinfo of periodinfos){
                let id = 'file-upload-'+keywordinfo.keyword.split(" ").join("-");
                if(keywordinfo.illustration.length>0){
                    if(document.getElementById('crop-check').checked)keywordinfo.illustration =keywordinfo.keyword+'_cropped.png';
                    fetch('images/'+(keywordinfo.illustration)).then(response => response.blob()).then(blob=>{
                        let input = document.getElementById(id);
                        let label = input.parentElement.childNodes[1];
                        label.innerHTML = '';
                        changeImage(label,blob);
                    })
                }
            }
        }


        function changeImageFromInputEvent(evt){
            const file = event.target.files[0];
            if (file) {
                const blob = new Blob([file], { type: file.type });
                let label = evt.srcElement.parentElement.childNodes[1];
                labek.innerHTML='';
                changeImage(label,blob);
            }
        }

        function changeImage(parent,blob){
            const img = document.createElement('img');
            img.src = URL.createObjectURL(blob);
            parent.appendChild(img)
        }

        document.getElementById('crop-check').addEventListener('change',(evt)=>{
           let checked = evt.currentTarget.checked;
           let labels =Array.from(document.getElementById('keywordslist').getElementsByTagName('label'));
           fetch("keywords_illustration.json").then(res=>res.json()).then(allkeywordsinfo=>{
               for (let label of labels){
                   let id = label.getAttribute('for')
                   let keyword = label.getAttribute('for').replace('file-upload-',"")
                   let path = 'images/'+allkeywordsinfo[keyword].illustration;
                   if(checked)path ='images/'+keyword+'_cropped.png';
                   if(allkeywordsinfo[keyword].illustration.length>0){
                        fetch(path).then(response => response.blob()).then(blob=>{
                                let input = document.getElementById(id);
                                let label = input.parentElement.childNodes[1];
                                label.innerHTML = '';
                                changeImage(label,blob);
                            })
                    }
                }
            })

        })
    </script>
</body>
</html>